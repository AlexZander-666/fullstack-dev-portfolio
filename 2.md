# 项目问题与改进建议

## 后端
- **MongoDB 注入防护未生效**：`backend/src/index.ts` 中调用 `mongoSanitize.sanitize` 但未使用返回值，实际没有移除 `$`/`.` 字段，`projects` 等未做 schema 校验的路由仍可被 NoSQL 注入。建议改为 `app.use(mongoSanitize({ replaceWith: "_" }));` 放在路由前，或显式覆写 `req.body/req.query` 的净化结果。
- **项目 ID 缺少校验**：`backend/src/routes/projects.routes.ts` 的 `/:id` GET/PUT/DELETE 未使用 `validateObjectId()`，传入非法 ObjectId 会抛 CastError 直接返回 500。建议为所有包含 `:id` 的项目路由补充 `validateObjectId()` 中间件并保持 404/400 语义。
- **项目查询缺少校验/清洗**：`getProjects` 直接使用 `req.query.featured`，配合上面的 sanitize 问题可被构造 `?featured[$ne]=true` 绕过过滤。建议为项目列表添加 zod schema（参考 `postQuerySchema`）并复用 `validate`/`validatePagination`。
- **请求体大小无限制**：当前 `express.json()`/`urlencoded()` 使用默认 100kb 上限，易被大包打满内存。建议设定明确上限如 `app.use(express.json({ limit: "1mb" }))` 和同样大小的 `urlencoded`。
- **测试依赖版本不匹配**：`backend/package.json` 使用 `jest@30.2.0` 搭配 `ts-jest@29.4.6`，该版本组合未正式兼容 Jest 30，TS 测试可能无法运行。建议降级 Jest 至 29.x 或升级到兼容 Jest 30 的 ts-jest 版本后再跑 `npm test`.

## 前端
- **博客与管理页仍用假数据**：`frontend/src/app/blog/*`、`frontend/src/app/admin/*` 均是 mock 数据并带有 TODO，未调用后端 API，删除/标记已读等操作也未接通，真实数据和权限无法体现。建议用 `lib/api.ts` 或新增 admin API 封装请求后端，处理加载/错误/分页，替换掉所有 mock。
- **元数据与真实文章脱节**：`frontend/src/app/blog/[slug]/page.tsx` 的 `generateMetadata` 基于 `mockPosts`，发布的后台文章不会出现在 OG/SEO 信息里。建议在 `generateMetadata` 中调用后端 `getPostBySlug` 获取真实数据并处理 404。
- **中间件仅检查 cookie 存在**：`frontend/src/middleware.ts` 只判断 token 是否存在而不验证有效性，过期/伪造 cookie 会先放行再由客户端跳转，造成闪屏。可在中间件解析 JWT（捕获异常即重定向）或调用轻量 `/auth/refresh` 以提前拒绝无效会话。

## 1.md 待办完成度
- 文件编码已损坏，需修复存储格式后再长期使用；以下基于可辨认的复选框判断。
- 已完成：JWT 密钥必填、启动环境变量检查、HttpOnly Cookie 登录流、搜索正则转义、防爆破限流、Helmet、密码复杂度、CORS 配置、联系分页与 XSS 清洗、ObjectId 校验（posts/contact）、Winston 日志、测试框架搭建、slug 冲突检查、邮件通知、Next.js Image/超时处理/React.memo 等前端项。
- 未完成/偏差：`express-mongo-sanitize` 尚未正确应用（待办 7 对应的防注入仍失效）；项目路由/查询未覆盖 ID 校验和清洗，建议比对待办清单补齐。
